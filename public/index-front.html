<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>Союзмультпарк — AR (селфи)</title>
  <style>
    html, body { margin:0; padding:0; height:100%; overflow:hidden; font-family: system-ui, -apple-system, Arial; background:#000; }
    .gate { position: fixed; inset: 0; display: grid; place-items: center; background: rgba(0,0,0,.85); color:#fff; z-index: 25; text-align:center; padding:24px; }
    .gate button { padding: 12px 16px; border-radius: 12px; border: none; background: #1a1a1a; color: #fff; font-weight: 800; }
  </style>
  <script src="https://unpkg.com/aframe@1.4.2/dist/aframe.min.js"></script>
  <script src="https://unpkg.com/mind-ar@1.1.5/dist/mindar-image.prod.js"></script>
  <script src="https://unpkg.com/mind-ar@1.1.5/dist/mindar-image-aframe.prod.js"></script>
</head>
<body>
  <div id="start" class="gate">
    <div>
      <h2>Селфи-камера</h2>
      <p>Если задняя камера не запускается — попробуйте селфи-камеру.</p>
      <button id="go">Включить селфи-камеру</button>
    </div>
  </div>

  <a-scene
    renderer="alpha:true; colorManagement:true; physicallyCorrectLights:true; antialias:true"
    embedded
    vr-mode-ui="enabled:false"
    device-orientation-permission-ui="enabled:true"
    mindar-image="autoStart: false; imageTargetSrc: ./targets/targets.mind"
  >
    <a-entity light="type: ambient; intensity: 0.9"></a-entity>
    <a-entity light="type: directional; intensity: 0.8" position="0 1 0"></a-entity>

    <a-entity id="tgt-cheb" mindar-image-target="targetIndex: 0">
      <a-sphere radius="0.08" color="orange" position="0 0.2 0"></a-sphere>
    </a-entity>
    <a-entity id="tgt-shapo" mindar-image-target="targetIndex: 1">
      <a-cone radius-bottom="0.12" height="0.25" color="#9c88ff" position="0.1 0.25 0.05"></a-cone>
    </a-entity>
    <a-entity id="tgt-volk" mindar-image-target="targetIndex: 2">
      <a-box depth="0.08" height="0.14" width="0.12" color="#2ecc71" position="0.35 0.08 0.05"></a-box>
    </a-entity>

    <a-camera position="0 0 0"></a-camera>
  </a-scene>

  <script>
    (()=>{
      const scene = document.querySelector('a-scene');
      document.getElementById('go').addEventListener('click', async ()=>{
        document.getElementById('start').remove();
        // MindAR не даёт явный выбор фронт/тыл в A-Frame 1.1.5,
        // но на части устройств после «жеста» OS подсовывает фронталку.
        // Если не подхватится — всё равно проверим, стартует ли вообще поток.
        try{ await scene.systems['mindar-image-system'].start(); }catch(e){ alert('Старт не удался'); }
      });
    })();
  </script>
</body>
</html>
